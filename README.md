[![CircleCI](https://circleci.com/gh/travismcchesney/mail-it.svg?style=shield)](https://circleci.com/gh/travismcchesney/mail-it)

# Mail It

## Building

First you'll need to have `java sdk >= 1.8.0` and `maven >= 3.2.5`.

1. Run `mvn package` to build and package up the application

## Testing

Run `mvn test` to run the unit tests only.

## Starting

MailIt can be started locally using either the fat Jar generated by the `Building` step above, or by using the
pre-built docker container.

### Jar

The `jar` contains everything needed to run the application. Simply start it like so:

`java -jar target/mailit-1.1.jar server config.yml`

### Docker

The docker image also contains everything needed to run the application. Simply start it like so:

```
docker run -d \
 --name mailit --rm \
 -p 8080:8080 -p 8081:8081 \
 -e "DW_MAIL_PROVIDER=mailgun" \
 -e "DW_MAILGUN_API_KEY=<mailgun-api-key>" \
 travismcchesney/mailit:1.1
```

## Configuring

### Environment Variables

The first (recommended) way to configure the application is with the following environment variables:
* DW_MAIL_PROVIDER: Specify the email provider to use. One of `sendgrid` or `mailgun`. If omitted, `sendgrid` is the
default
* DW_MAILGUN_API_KEY: Specify the Mailgun API key, if applicable
* DW_SENDGRID_API_KEY: Specify the Sendgrid API key, if applicable

### Config File

Alternatively, you can update the `config.yml` file to set the configuration values:
* `mailProvider`: Specify the email provider to use. One of `sendgrid` or `mailgun`.
* `mailgunApiKey`: Specify the Mailgun API key, if applicable
* `sendgridApiKey`: Specify the Sendgrid API key, if applicable

## Using

1. If running locally with the Jar or docker, the application can now be used at `http://localhost:8080`
1. To test things out without running locally, use `http://mailit.travis.technology`.

## Monitoring

To inspect the health of the application, navigate to `http://localhost:8081/healthcheck`

## Examples

```bash
curl -X POST \
  http://localhost:8080/email \
  -H 'Content-Type: application/json' \
  -d '{
	"to": "jack@example.com",
	"to_name": "Jack",
	"from": "noreply@paperstreetsoapco.com",
	"from_name": "Tyler Durden",
	"subject": "A Message from Paper Street Soap Co.",
	"body": "<h1>Your Bill</h1><p>$10</p>"
}'
```

## Docker

To build the docker container for a new version, run from the project root:

`docker build -t <repo>/mailit:<version> .`

`docker push`

## Notes

### Language, Framework, Libraries

### Tradeoffs

### Additional